<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Activity Rating</title>
    <!-- Include Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f2f2f2;
        }

        header {
            background-color: #333;
            color: white;
            text-align: center;
            padding: 20px;
        }

        main {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        .activity-card {
            background-color: #fff;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.2);
        }
    </style>
</head>
<body>
    <header>
        <h1>Event Rating</h1>
    </header>
    <main>
        <section id="activities">
            <!-- Activities will be added here dynamically -->
        </section>
    </main>

    <script>
        // Function to display activities and allow users to rate them
        function displayActivities() {
            const activitiesSection = document.getElementById("activities");
            const activities = JSON.parse(localStorage.getItem("events")) || [];

            // Load ratings from local storage if available
            const storedRatings = JSON.parse(localStorage.getItem("ratings")) || [];

            // Display each activity
            activities.forEach((activity, index) => {
                const activityCard = document.createElement("div");
                activityCard.className = "activity-card card mb-3";
                activityCard.innerHTML = `
                    <div class="card-body">
                        <h5 class="card-title">${activity.name}</h5>
                        <p class="card-text">${activity.details}</p>
                        <p class="card-text">Guest: ${activity.guest}</p>
                        <p class="card-text">Date: ${activity.date}</p>
                        <p class="card-text">Timing: ${activity.time}</p>
                        <p class="card-text">Rate this activity:</p>
                        <input type="number" min="1" max="5" class="form-control" id="rating${index + 1}">
                        <input type="text" class="form-control" id="userName${index + 1}" placeholder="Your Name">
                        <button class="btn btn-success" onclick="rateActivity(${index + 1}, '${activity.name}')">Submit Rating</button>
                    </div>
                `;

                // Check if a rating exists for this activity
                const storedRating = storedRatings.find((rating) => rating.activity === activity.name);

                if (storedRating) {
                    activityCard.querySelector(`#rating${index + 1}`).value = storedRating.rating;
                    activityCard.querySelector(`#userName${index + 1}`).value = storedRating.name;
                }

                activitiesSection.appendChild(activityCard);
            });
        }

        // Function to rate an activity and store it in local storage
        function rateActivity(activityIndex, activityName) {
            const ratingInput = document.getElementById(`rating${activityIndex}`);
            const userNameInput = document.getElementById(`userName${activityIndex}`);

            const rating = parseInt(ratingInput.value);
            const userName = userNameInput.value.trim();

            if (isNaN(rating) || rating < 1 || rating > 5) {
                alert("Please enter a valid rating between 1 and 5.");
                return;
            }

            if (!userName) {
                alert("Please enter your name.");
                return;
            }

            const userRating = {
                name: userName,
                activity: activityName,
                rating: rating
            };

            // Retrieve existing ratings from local storage or initialize an empty array
            let ratings = JSON.parse(localStorage.getItem("ratings")) || [];

            // Check if the user has already rated this activity
            const existingRatingIndex = ratings.findIndex((r) => r.name === userName && r.activity === activityName);

            if (existingRatingIndex !== -1) {
                // If the user has already rated this activity, update the rating
                ratings[existingRatingIndex] = userRating;
            } else {
                // If the user has not yet rated this activity, add the new rating
                ratings.push(userRating);
            }

            // Store the updated ratings array in local storage
            localStorage.setItem("ratings", JSON.stringify(ratings));

            // Clear the form fields after submitting the rating
            ratingInput.value = "";
            userNameInput.value = "";

            alert("Rating submitted successfully.");
        }

        // Load activities and ratings on page load
        window.onload = function () {
            displayActivities();
        }
    </script>

    <!-- Include Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.5.0-alpha1/dist/js/bootstrap.min.js"></script>
</body>
</html>
